<!DOCTYPE html>

<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">


<head>
    <script type="text/javascript" src="textToSpeech.js"></script>
    <script type="text/javascript" src="autocomplete_handler.js"></script>
    <script type="text/javascript" src="dep.js"></script>
    <script type="text/javascript" src="api_requests.js"></script>
    <script type="text/javascript" src="words_handler.js"></script>
    <script type="text/javascript" src="jokes.js"></script>
    <script type="text/javascript" src="style.css"></script>
    <script type="text/javascript" src="TreeMenu.js"></script>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Montserrat">

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto">

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=OpenSans">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

    <link rel="stylesheet"
          type="text/css"
          href="style.css"
    />

    <link rel="icon"
          type="image/svg"
          href="images/flags/ru.svg">

    <meta charset="UTF-8">
    <title>Linkify</title>


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-192439310-1">
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-192439310-1');
    </script>
</head>
<body>


<header style="background: #000066; margin-top: -10px; margin-left: -10px; margin-right: -10px">


    <table>
        <tr>

            <td width="10%">
            </td>

            <td width="21%">
                <img src="images//logo2.png" title="Search for meaning"
                     style="width:80px;height:80px;">
            </td>


            <td width="35%">
                <table>
                    <td width="10%">
                        <input id="searchfield" value="" type="text" placeholder="Search"
                               style="height: 40px; width: 300px; border-radius: 5px; background-color: lightgray; color: black">
                    </td>

                    <td width="90%">
                        <a href="#" onclick="dosearch(1)" style="padding-top: 200px">
                            <img src="images//loupe.svg" title="Search for meaning"
                                 style="width:30px;height:30px; padding-top: 0px">
                        </a>
                    </td>
                </table>
            </td>


            <td width="34%" style="alignment: right">
                <button class="imagebutton" onclick="window.open('settings_page.html')" onhover="f1()">
                    <img id="settings_button" src="images/settings.svg" title="Settings"
                         style="width:30px;height:30px; line-height: 0;">
                    <br>
                    Settings
                </button>

                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

                <button id="speaking_button_thingie" class="imagebutton" onclick="openspeaking()"
                        style="visibility: visible">
                    <img id="speaking_button" src="images/speak_pa.svg" title="Speaking"
                         style="width:30px;height:30px; line-height: 0;">
                    <br>
                    Speaking
                </button>

                <button class="imagebutton" onclick="make_menu()" onhover="f1()">
                    <img id="book_button" src="images/book.svg" title="Reading"
                         style="width:30px;height:30px; line-height: 0;">
                    <br>
                    Reading
                </button>


                <button id="vocab_button_thingie" class="imagebutton" onclick="openvoc()" onhover="f1()"
                        style="visibility: visible">
                    <img id="vocab_button" src="images/test.svg" title="Vocabulary"
                         style="width:30px;height:30px; line-height: 0;">
                    <br>
                    Vocabulary
                </button>


                <button id="listening_button_thingie" class="imagebutton" onclick="openlistening()"
                        style="visibility: visible">
                    <img id="listening_button" src="images/listening.svg" title="Listening"
                         style="width:30px;height:30px; line-height: 0;">
                    <br>
                    Listening
                </button>

            </td>

            <td width="0%">
                <div id="container1" hidden="true">
                    <table>
                        <td>
                            <label style="font-size: 14px"><b>Login</b></label>
                            <br>
                            <input type="text" placeholder="Enter login" id="login_name"
                                   style="width: 100px; height: 15px; font-size: 12px; border-radius: 5px">
                        </td>

                        <td>
                            <label style="font-size: 14px"><b>Password</b></label>
                            <br>
                            <input type="password" placeholder="Enter password" id="login_pass"
                                   style="width: 100px; height: 15px; font-size: 12px; border-radius: 5px">
                        </td>


                        <td>
                            <table>

                                <tr>
                                    <label style="font-size: 14px; text-align: center">Sign in to get extra
                                        features</label>
                                </tr>

                                <tr>
                                    <td>
                                        <button class="smallbutton" style="height: 21px; font-size: 14px"
                                                onclick="try_authorize()">Sign in
                                        </button>
                                    </td>
                                    <td>
                                        <button class="smallbutton" style="height: 21px; font-size: 14px"
                                                onclick="try_register()">Sign up
                                        </button>
                                    </td>
                                </tr>

                            </table>
                    </table>
                </div>


                <div id="container2" hidden='true' align="center">
                    <table>
                        <td>
                            <p id="grr"></p>
                        </td>

                        <td>
                            <button class="smallbutton" style="height: 25px" onclick="log_out()">Log out</button>
                        </td>
                    </table>

                </div>
                
    </table>


</header>



<section style="padding-top: 5px">
    <nav>

        <td width="25%">
            <textarea type="text" id="text" cols=45 rows="10"
                      style="width: 80%; background-color: lightgray; color: black;  border-radius: 5px 5px 0 0"
                      placeholder="Enter some text or drop a .txt file here" ondrop="dropBook(event)"></textarea>
        </td>

        <table class="pane">
            <tr>

                <td>

                    <div class="slidecontainer" hidden="true" id="sld">
                        <table>

                            <tr>
                                <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
                            </tr>

                            <tr>


                                <td>
                                    <a href="#" onclick="doback()">
                                        <img src="images//prev.svg" title="Previous page"
                                             style="width:40px;height:40px;">
                                    </a>
                                </td>

                                <td>
                                    <p id="demo" style="width: 100px"></p>
                                </td>

                                <td>
                                    <a href="#" onclick="dofwd()">
                                        <img src="images//next.svg" title="Next page"
                                             style="width:40px;height:40px;">
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <table>
                        <td width="15%">
                            <a href="#" id="trans_button" onclick="f()">
                                <img src="images/scroll.svg" title="Linkify"
                                     style="width:55px;height:55px;">
                            </a>
                        </td>

                        <td width="15%">
                            <a href="#" id="history_button" onclick="do_history()">
                                <img src="images/history.svg" title="History"
                                     style="width:55px;height:55px;">
                            </a>
                        </td>


                        <td width="10%">
                            <a href="#" onclick="speak(getSelectionText())">
                                <img src="images/audio.png" title="Sound selected text out (=S)"
                                     style="width:55px;height:55px;">
                            </a>
                        </td>

                        <td width="15%">
                            <label class="form-switch">
                                <input type="checkbox" id="translation_toggle">
                                <i></i>
                                <br>


                                <img src="images//translate.svg" title="Translate"
                                     style="width:35px;height:35px; alignment: center">


                            </label>
                        </td>


                        <td width="5%">

                        </td>

                        <td width="20%">
                            <a href="#" onclick="handleback()">
                                <img src="images/prev.svg" title="Previous article (left arrow key)"
                                     style="width:30px;height:30px;">
                            </a>
                        </td>
                    </table>
                </td>

            </tr>
        </table>

        <div id="bodydesc2">
            <p id="prono_part" style="font-size:16px"></p>
        </div>

        <div id="bodydesc3">
            <p id="ety_part" style="font-size:13px; font-family: Verdana"></p>
        </div>
    </nav>
    <article>
        <div id="bodydesc">
            <p id="demonstrative" class="ex1" style="font-size: 16px"></p>
        </div>
        <hr>
        <p id="content"></p>
    </article>
</section>

<script>

    const __queryString = window.location.search;
    __urlParams = new URLSearchParams(__queryString);
    //let _login = urlParams.get('login')
    //let _pass = urlParams.get('password')

    let _login = "uniuser2"
    let _pass = "h17zvrtp"

    //h17zvrtp

    accept_lang()


    init_native_lang()

    let instruction = " <h3>Welcome to Linkify</h3>\n" +
        "            <p style='font-size: 15px'>\n" +
        "                Just put some text into the box on the left and click <img src=\"images/scroll.svg\" alt=\"Explore text\" title=\"Linkify\"\n" +
        "                         style=\"width:30px;height:30px;\"> icon right above the box. <br> It will turn words from the text into clickable links, so you can read the text while looking up articles on words you're unfamiliar with.\n" +
        "            </p> <br> Click <a target='_blank' href = 'https://www.youtube.com/watch?v=Ei1RRm334eA'>here</a> for a demo."

    //instruction ="<a href = \"#a\" class = \"adjective\" onclick=\"hndwrd('запре́тный=canonical=запретный')\">Запре́тный</a> <a href = \"#a\" class = \"noun\" onclick=\"hndwrd('лес=canonical=лес')\">лес</a>. <a href = \"#a\" class = \"adverb\" onclick=\"hndwrd('наве́рное=canonical=наверное')\">Наве́рное</a>"

    //doc =  my_popup.document;
    elem = document.getElementById("demonstrative")
    //elem.innerHTML = instruction
    elem.innerHTML = instruction

    cont = document.getElementById("content")
    ety = document.getElementById("ety_part")
    prono = document.getElementById("prono_part")

    console.log("href", window.location.href)
    if (window.location.href.indexOf("einhornus") != -1) {
        window.location.replace("http://174.138.15.163//linkify.html#");
    }

    //document.getElementById("searchfield").value = "на"
    //dosearch(1)

    //document.getElementById("searchfield").value = "language"
    //dosearch(1)


    let fff_thing = 0;

    function ffff() {
        document.getElementById("star1").hidden = !document.getElementById("star1").hidden
        document.getElementById("star2").hidden = !document.getElementById("star2").hidden
        document.getElementById("star3").hidden = !document.getElementById("star3").hidden
        fff_thing = 1;
    }

    function ffff2() {
        document.getElementById("star1").hidden = !document.getElementById("star1").hidden
        document.getElementById("star2").hidden = !document.getElementById("star2").hidden
        document.getElementById("star3").hidden = !document.getElementById("star3").hidden
        fff_thing = 2;
    }

    function openvoc(ind) {
        link = "vocabulary_test.html?";
        link += "&lang=" + std_langs[main_lang]
        if (the_login != null) {
            link += "&login=" + the_login + "&password=" + the_password
        }
        window.open(link, '_blank');
    }

    function openlistening() {
        link = "listening.html?";
        link += "&lang=" + std_langs[main_lang]
        if (the_login != null) {
            link += "&login=" + the_login + "&password=" + the_password
        }
        window.open(link, '_blank');
    }

    function openspeaking() {
        if(main_lang != 0) {
            link = "audiorec.html?";
            link += "&lang=" + std_langs[main_lang]
            window.open(link, '_blank');
        }
        else{
            window.open("https://einhornus.github.io/linkify_speaking/separate_speaking.html", '_blank');
        }
    }


    make_menu()


    if (_login != null) {
        try_authorize(_login, _pass)
    }

    //_login = _login.replace(' ', '5')
    //_pass = _pass.replace(' ', '5')

    //last_login = getCookie_("last_login")
    //last_password = getCookie_("last_password")


    //if (_login != null) {
    //    try_authorize(_login, _pass)
    //}
    //else{

    /*
    last_login = getCookie_("last_login")
    last_password = getCookie_("last_password")

    if (last_login != null && last_login.length > 0) {
        if (last_password.indexOf("encrypted___") != 0) {
            try_authorize(last_login, last_password)

            ___api_encrypt(last_password, function (encrypted_pass) {
                setCookie_("last_password", encrypted_pass, 100000)
            })
        } else {
            ___api_decrypt(last_password, function (decrypted) {
                try_authorize(last_login, decrypted)
            })
        }
    } else {
        init_start()
    }
     */

    function f1() {
        document.getElementById("linkify_button").src = "images/hard.svg";
    }

    //}
    init_start()

    /*
    const et = document.getElementById("examples_toggle");
    et.onclick = () => {
        examplesStage = et.checked
        put_info(last_word_loaded[0], last_word_loaded[1], last_word_loaded[2])
    };
    */

    const et2 = document.getElementById("translation_toggle");
    et2.onclick = () => {
        translatedStage = et2.checked
        if (i_see_joke) {
            update_slider()
        } else {
            f()
        }
        //do_translate()
        //put_info(last_word_loaded[0], last_word_loaded[1], last_word_loaded[2])
    };


    apply_autocomplete()


    function dropBook(ev) {
        console.log('File(s) dropped');

        // Prevent default behavior (Prevent file from being opened)
        ev.preventDefault();

        if (ev.dataTransfer.items) {
            // Use DataTransferItemList interface to access the file(s)
            for (var i = 0; i < ev.dataTransfer.items.length; i++) {
                // If dropped items aren't files, reject them
                if (ev.dataTransfer.items[i].kind === 'file') {
                    var file = ev.dataTransfer.items[i].getAsFile();
                    file.text().then(text => addCustomBook(file.name, text));
                }
            }
        } else {
            /*
            for (var i = 0; i < ev.dataTransfer.files.length; i++) {

                var file = ev.dataTransfer.items[i].getAsFile();
                file.text().then(text => console.log(text));

                console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].text());
            }

             */
        }
    }


    function do_history() {
        d1 = document.getElementById("demonstrative")
        if(d1.innerHTML.indexOf("Just put some text into the box")!=-1){
            d1.innerHTML = ""
        }

        html = "<h2>Recently viewed words</h2>"

        sss = new Set()

        html += "<ul>"
        for (let i = history2.length - 1; i >= 0; i--) {
            console.log(sss, sss.has(history2[i]))
            if(!sss.has(history2[i])) {
                html += "<li>" + history2[i] + "</li>"
                if (sss.size >= 20) {
                    break;
                }
                sss.add(history2[i])
            }
        }
        html += "</ul>"

        handleText(html, function (handled) {
            cont.innerHTML = handled;

            ety.innerHTML = "";
            prono.innerHTML = "";
        })
    }

    inittts()
    read_history()
</script>

</body>
</html>

